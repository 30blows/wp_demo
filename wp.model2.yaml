doctype: com.datagridsys.doctype/skopos/model
version: 1

components:
    db:
        # repo:  https://hub.docker.com/r/healthcheck/mariadb/
        # check:  https://github.com/docker-library/healthcheck/blob/master/mysql/docker-healthcheck
        image: healthcheck/mariadb
        singleton: true
        provides:
            ports: ["${db_port}"]
        env:
            MYSQL_USER: ${db_user}
            MYSQL_PASSWORD: ${db_password}
            MYSQL_DATABASE: ${db_database}
            MYSQL_ROOT_PASSWORD: ${db_secret}
        volumes:
            db_data2:
                path: /var/lib/mysql
        plugin:
            docker-swarm:
                # comment out 'args' line to inject failure
                args: ["--extra-port=${db_port}"]
                raw:
                    TaskTemplate:
                        Placement:
                            Constraints:
                                - node.role == manager
        visual:
            x: 700
            y: 100

    wordpress:
        image: wordpress:4.8.0-php7.0     # 4.8.0-php7.0 or 4.8.0-php7.1
        singleton: true
        provides:
            ports: ["80"]
        uses:
            db: {}
        env:
            WORDPRESS_DB_HOST: db:${db_port}
            WORDPRESS_DB_USER: ${db_user}
            WORDPRESS_DB_PASSWORD: ${db_password}
            WORDPRESS_DB_NAME: ${db_database}
        volumes:
            wp_data2:
                path: /var/www/html
        visual:
        visual:
            x: 400
            y: 100

doctype: com.datagridsys.doctype/skopos/model
version: 1
gateways:
    hp-8082:
        exposes:
            - port: "8082"
              target_port: "80"
        target: [wordpress]
        type: host_port
        visual:
            x: 100
            y: 100
